# =============================================================================
# PDF CONVERTER PIPELINE v2.0 - –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô ENVIRONMENT CONFIGURATION
# –î–æ–±–∞–≤–ª–µ–Ω—ã –í–°–ï –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ª–æ–≥–æ–≤ Docker Compose
# =============================================================================

# =============================================================================
# üîß –û–°–ù–û–í–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# =============================================================================
PROJECT_VERSION=2.0
ENVIRONMENT=production

# –ü—É—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
BASE_PATH=/mnt/storage/docker/pdf-converter
HF_HOME=/mnt/storage/models/huggingface
PADDLEX_HOME=/mnt/storage/models/paddlex
DOCLING_HOME=/mnt/storage/models/docling
HF_CACHE_HOME=/mnt/storage/models/docling/huggingface
TRANSFORMERS_CACHE=/${HF_HOME}/transformers_cache
HF_MODULES_CACHE=${HF_HOME}/modules_cache
PADDLEOCR_HOME=/mnt/storage/models/paddleocr
DOCLING_MODEL_PATH=/mnt/storage/models/docling

# =============================================================================
# ü§ñ vLLM –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–ò–°–ü–†–ê–í–õ–ï–ù–û!)
# =============================================================================
VLLM_SERVER_URL=http://vllm-server:8000

# –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏
VLLM_CONTENT_MODEL=Qwen/Qwen2.5-VL-32B-Instruct
VLLM_TRANSLATION_MODEL=Qwen/Qwen3-30B-A3B-Instruct-2507

# –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å docker-compose (–∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ vllm-server)
VLLM_MODEL_NAME=${VLLM_CONTENT_MODEL}
VLLM_TRANSLATION_MODEL=${VLLM_TRANSLATION_MODEL}

# –¢–∞–π–º-–∞—É—Ç—ã (—Å–µ–∫—É–Ω–¥—ã)
VLLM_STANDARD_TIMEOUT=1800

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è 2x A6000
VLLM_TENSOR_PARALLEL_SIZE=2
VLLM_PIPELINE_PARALLEL_SIZE=1
VLLM_GPU_MEMORY_UTILIZATION=0.9
VLLM_MAX_MODEL_LEN=8192
VLLM_MAX_NUM_SEQS=32
VLLM_BLOCK_SIZE=16

# Dynamic model loading
DYNAMIC_MODEL_LOADING=true
MODEL_SWAP_TIMEOUT=300
AUTO_MODEL_SELECTION=true

# API –∫–ª—é—á
VLLM_API_KEY=pdf-converter-secure-key-2024

DISABLE_THINKING=true

# =============================================================================
# üì° –ú–ï–ñ–°–ï–†–í–ò–°–ù–´–ï URL (–ò–°–ü–†–ê–í–õ–ï–ù–û!)
# =============================================================================
AIRFLOW_BASE_URL=http://airflow-webserver:8080
DOCUMENT_PROCESSOR_URL=http://document-processor:8001
QUALITY_ASSURANCE_URL=http://quality-assurance:8002
TRANSLATOR_URL=http://translator:8003

# =============================================================================
# üåä AIRFLOW –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–ü–û–õ–ù–ê–Ø)
# =============================================================================
AIRFLOW_UID=1000
AIRFLOW_GID=0
AIRFLOW_PROJ_DIR=.

_AIRFLOW_WWW_USER_USERNAME=admin
_AIRFLOW_WWW_USER_PASSWORD=admin

AIRFLOW__API__AUTH_BACKENDS=airflow.api.auth.backend.basic_auth,airflow.api.auth.backend.session
AIRFLOW__WEBSERVER__EXPOSE_CONFIG=true

AIRFLOW__CORE__FERNET_KEY=UKMzEm3yIuFYEq1y3-2FxPNWSVwRASpahmQ9kQfEr8Q=
AIRFLOW_SECRET_KEY=2FxPNWSVwRASpahmQ9kQfEr8Q=
AIRFLOW__WEBSERVER__SECRET_KEY=${AIRFLOW_SECRET_KEY}

AIRFLOW__CORE__SECURITY=True
AIRFLOW__API__ENABLE_EXPERIMENTAL_API=False

AIRFLOW__CORE__EXECUTOR=CeleryExecutor
AIRFLOW__CELERY__BROKER_URL=redis://redis:6379/0
AIRFLOW__CELERY__RESULT_BACKEND=db+postgresql://airflow:airflow@postgres/airflow
AIRFLOW__CELERY__BROKER_CONNECTION_RETRY_ON_STARTUP=true
AIRFLOW__WEBSERVER__ENABLE_SWAGGER_UI=false

AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=false
AIRFLOW__CORE__LOAD_EXAMPLES=false

# ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ Airflow –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ª–æ–≥–æ–≤
AIRFLOW__METRICS__STATSD_ON=false
AIRFLOW__METRICS__STATSD_HOST=statsd-exporter
AIRFLOW__METRICS__STATSD_PORT=9125
AIRFLOW__METRICS__STATSD_PREFIX=airflow
AIRFLOW__METRICS__METRICS_ALLOW_LIST=
AIRFLOW__METRICS__METRICS_BLOCK_LIST=

AIRFLOW__CORE__METRICS_USE_PATTERN_MATCH=false
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=8
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=64
AIRFLOW__CORE__DAGBAG_IMPORT_TIMEOUT=1200
AIRFLOW__CORE__PARALLELISM=256

AIRFLOW__LOGGING__LOGGING_LEVEL=INFO
AIRFLOW__WEBSERVER__LOGGING_LEVEL=INFO
AIRFLOW__WEBSERVER__WEB_SERVER_WORKER_TIMEOUT=1200

AIRFLOW__CELERY__WORKER_CONCURRENCY=32
AIRFLOW__CELERY__OPERATION_TIMEOUT=43200

AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_SIZE=200
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_RECYCLE=3600
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_PRE_PING=true

_PIP_ADDITIONAL_REQUIREMENTS=

# =============================================================================
# üìù PDF PROCESSING (–ù–ï–î–û–°–¢–ê–Æ–©–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï)
# =============================================================================
DEFAULT_EXTRACT_TABLES=true
DEFAULT_EXTRACT_IMAGES=true
DEFAULT_USE_OCR=true
CREATE_SEPARATE_FOLDERS=true
EMBED_IMAGES_IN_MD=false
DEFAULT_LANGUAGE=original
DEFAULT_MODEL_SIZE=large

# =============================================================================
# üõ†Ô∏è FLASK API –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# =============================================================================
FLASK_SECRET_KEY=your_super_secret_key_here_change_in_production
FLASK_ENV=production
FLASK_DEBUG=false
MAX_CONTENT_LENGTH=1073741824

# =============================================================================
# üìÅ –î–ò–†–ï–ö–¢–û–†–ò–ò –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò (–î–û–ë–ê–í–õ–ï–ù TEMP_FOLDER)
# =============================================================================
INPUT_DIR=/app/input
OUTPUT_DIR=/app/output
TEMP_DIR=/app/temp
TEMP_FOLDER=/app/temp

UPLOAD_FOLDER=/app/input_pdf
OUTPUT_FOLDER_ZH=/app/output_md_zh
OUTPUT_FOLDER_RU=/app/output_md_ru
OUTPUT_FOLDER_EN=/app/output_md_en

# =============================================================================
# üóÉÔ∏è POSTGRESQL –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 2TB RAM)
# =============================================================================
POSTGRES_DB=airflow
POSTGRES_USER=airflow
POSTGRES_PASSWORD=airflow123

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PostgreSQL
POSTGRES_SHARED_BUFFERS=128GB
POSTGRES_EFFECTIVE_CACHE_SIZE=1536GB
POSTGRES_MAINTENANCE_WORK_MEM=32GB
POSTGRES_WAL_BUFFERS=2GB
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_DEFAULT_STATISTICS_TARGET=1000
POSTGRES_RANDOM_PAGE_COST=1.1
POSTGRES_EFFECTIVE_IO_CONCURRENCY=1000
POSTGRES_WORK_MEM=1GB
POSTGRES_SHARED_PRELOAD_LIBRARIES=pg_stat_statements
POSTGRES_MAX_CONNECTIONS=1000

# =============================================================================
# üìä REDIS –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# =============================================================================
REDIS_MAXMEMORY=64GB
REDIS_MAXMEMORY_POLICY=allkeys-lru

# =============================================================================
# üìà GRAFANA –ú–û–ù–ò–¢–û–†–ò–ù–ì
# =============================================================================
GF_SECURITY_ADMIN_PASSWORD=admin

# =============================================================================
# ‚öôÔ∏è –°–ï–†–í–ò–°–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ (–î–û–ë–ê–í–õ–ï–ù–´ –ù–ï–î–û–°–¢–ê–Æ–©–ò–ï)
# =============================================================================
# Document Processor
PADDLEOCR_USE_GPU=true
PADDLEOCR_LANG=en,ch,ru
PADDLEOCR_USE_TEXTLINE_ORIENTATION=true
DOCLING_USE_GPU=true
DOCLING_MAX_WORKERS=4
OCR_CONFIDENCE_THRESHOLD=0.8
MAX_FILE_SIZE_MB=2000
PROCESSING_TIMEOUT_MINUTES=120
TESSERACT_CONFIG=--oem 3 --psm 6

# Quality Assurance
QA_ENABLED=true
QA_THRESHOLD=0.95
AUTO_CORRECTION_ENABLED=true
MAX_CORRECTIONS_PER_DOCUMENT=5
AST_COMPARISON_ENABLED=true
SSIM_THRESHOLD=0.95
VISUAL_DIFF_TOLERANCE=0.05
OCR_CROSS_VALIDATION=true

# Translator
SERVICE_PORT=8003
ENABLE_CACHING=true
CACHE_SIZE_LIMIT=5000
PRESERVE_TECHNICAL_TERMS=true
REQUEST_TIMEOUT=600
INTER_REQUEST_DELAY=0.2

# =============================================================================
# üîç –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –ë–ê–¢–ß–ò–ù–ì
# =============================================================================
BATCH_SIZE_HEADERS=4
BATCH_SIZE_TABLES=3
BATCH_SIZE_COMMANDS=2
BATCH_SIZE_TEXT=6
BATCH_SIZE_MIXED=4

# =============================================================================
# üìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# =============================================================================
LOG_LEVEL=INFO
VERBOSE_PROGRESS=true
SHOW_STATISTICS=true
SHOW_DETAILED_PROGRESS=true
LOG_ERRORS=true

MAX_REMAINING_FIXES=20
REMAINING_TIMEOUT=300
MAX_FIX_ATTEMPTS=2
MIN_FRAGMENT_LENGTH=2
CREATE_BACKUP=true
